{% extends 'base.html.twig' %}

{% block title %}Event{% endblock %}

{% block body %}
        <div class="box_container">
            <div class="grip">
             <i class="fa-solid fa-grip-lines fa-xl" style="color: #6b3d67;"><p class="grip-p">All Event</p></i>   
            </div>
            <div class="box-container">
                {% for event in events %}
                <div class="box" data-link="{{ path("Event_show",{'id':event.id}) }}">
                    <div class="box-up">
                        <div class="box-left">
                            <div class="date-box">
                                <p>{{ event.dateEvent|date("M")}}</p>
                                <p>{{ event.dateEvent|date("d")}}</p>
                            </div>
                            <img class="box-img" src="{{ asset('img/' ~ event.imageName) }}" alt="{{ event.imageName }}">
                        </div>
                        <div class="box-right">
                            <div class="date-box">
                                <p class="adress-p" >{{ event.adresse}}
                                {{ event.cp}} {{ event.city}}</p>
                                <i class="fa-solid fa-hand-peace"><p> <a href="{{ path('add_participant', {'id': event.id, 'userId': app.user.id}) }}">Book a Place</a></p></i>
                                <p class="learn-more"><a href="{{ path("Event_show",{'id':event.id}) }}"> Learn More</p>
                            </div>
                        </div>
                    </div>
                    <div class="box-dawn">
                        {# <p>ID <a href="{{ path("Event_show",{'id':event.id}) }}"> {{ event.id }} </a></p> #}
                        <p><a class="box-name" href="{{ path("Event_show",{'id':event.id}) }}"> {{event.name }} </a></p>
                        {% set places_left = event.places - event.participant|length %}
                        {% if places_left < 0 %}
                        {% set places_left = 0 %}
                        {% endif %}
                        <p>{{ places_left }} places left</p></p>
                    </div>
                        <p class="time">{{ event.dateEvent|date("l  H:i")}} le {{ event.dateEvent|date("d/m/Y") }}</p>
                        {% if is_granted("ROLE_ADMIN") %}
                            <a class="fa-solid fa-pen-to-square admin"  href="{{ path('Event_edit', {'id':event.id}) }}"> </a>
                            <a class="fa-solid fa-trash-can admin" href="{{ path('Event_del', {'id':event.id}) }}"> </a>
                        {% endif %}
                </div>
                {% endfor %}
            </div>
        <div class="pag">
            {{ knp_pagination_render(events)}}
        </div>
        </div>

{% endblock %}
{% block javascript %}
    <script>
    // get the current page path
var currentPath = window.location.pathname;

// check if it's the login page
if (currentPath === "/events") {

  // get the box-dawn and box-name elements
  var boxDawn = document.querySelector(".box-dawn");
  var boxName = document.querySelector(".box-name");

  // check if the boxName element's width is greater than its container's width
  if (boxName.offsetWidth > boxDawn.offsetWidth) {
    // if it is, set the gap of boxDawn to 0 and set its display property to flex
    boxDawn.style.gap = "0";
    
    boxDawn.style.display = "flex";
  } else {
    // if it's not, set the gap of boxDawn to 10px and set its display property to block
    boxDawn.style.gap = "10px";
    boxDawn.style.marginLeft = "10px";
    boxDawn.style.display = "block";
  }
}
   </script>
   <script>
        // Get all the box cards
        const boxCards = document.querySelectorAll('.box');

        // Loop through each box card
        boxCards.forEach(boxCard => {
        // Add a click event listener to each box card
        boxCard.addEventListener('click', () => {
            // Get the link from the data-link attribute
            const link = boxCard.getAttribute('data-link');
            
            // Redirect the user to the link
            window.location.href = link;
        });
        });
    </script>
{% endblock javascript %}